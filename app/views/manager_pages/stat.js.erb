<% if @attendances %>
  $('#stat-attendance-table').dataTable().fnDestroy();;
  $('#stat-attendance-table tbody').html('');
  <% (@attendances['waiters'] | @attendances['chefs'] | @attendances['cashiers'] | @attendances['bartenders'] | @attendances['managers'] | @attendances['customers']).each do |user| %>
    <% user['employee']['current_role'] = user['role'] %>
    $('#stat-attendance-table tbody').append("<%=j render partial: 'user_row', locals: { user: user['employee'] } %>");
  <% end %>
  var userTable = $('#stat-attendance-table').dataTable();
  var asInitUserVals = new Array();

  $("#stat-attendance-table tfoot input").keyup( function () {
    /* Filter on the column (the index) of this element */
    userTable.fnFilter( this.value, $("#stat-attendance-table tfoot th").index($(this).parent()) );
  } );

  /*
    * Support functions to provide a little bit of 'user friendlyness' to the textboxes in
    * the footer
    */
  $("#stat-attendance-table tfoot input").each( function (i) {
    asInitUserVals[i] = this.value;
  } );

  $("#stat-attendance-table tfoot input").focus( function () {
    if ( this.className == "search_init" )
    {
      this.className = "";
      this.value = "";
    }
  } );

  $("#stat-attendance-table tfoot input").blur( function (i) {
    if ( this.value == "" )
    {
      this.className = "search_init";
      this.value = asInitUserVals[$("#stat-attendance-table tfoot th").index($(this).parent())];
    }
  } );
  $('#customer-stat h2').html("<%= @attendances['customers'].length %><small> Customer</small>");
  $('#waiter-stat h2').html("<%= @attendances['waiters'].length %><small> Waiter</small>");
  $('#chef-stat h2').html("<%= @attendances['chefs'].length %><small> Chef</small>");
  $('#bartender-stat h2').html("<%= @attendances['bartenders'].length %><small> Bartender</small>");
  $('#cashier-stat h2').html("<%= @attendances['cashiers'].length %><small> Cashier</small>");
  $('#manager-stat h2').html("<%= @attendances['managers'].length %><small> Manager</small>");
<% end %>

<% if @sales %>
  $('#stat-sale-table').dataTable().fnDestroy();;
  $('#stat-sale-table tbody').html('');
  <% (@sales['sales'].values.sum).each do |s| %>
    $('#stat-sale-table tbody').append("<%=j render partial: 'sale_menu_item_row', locals: { sale_menu_item: s } %>");
  <% end %>
  var saleMenuItemTable = $('#stat-sale-table').dataTable();
  var asInitSaleMenuItemVals = new Array();

  $("#stat-sale-table tfoot input").keyup( function () {
    /* Filter on the column (the index) of this element */
    saleMenuItemTable.fnFilter( this.value, $("#stat-sale-table tfoot th").index($(this).parent()) );
  } );

  /*
    * Support functions to provide a little bit of 'user friendlyness' to the textboxes in
    * the footer
    */
  $("#stat-sale-table tfoot input").each( function (i) {
    asInitSaleMenuItemVals[i] = this.value;
  } );

  $("#stat-sale-table tfoot input").focus( function () {
    if ( this.className == "search_init" )
    {
      this.className = "";
      this.value = "";
    }
  } );

  $("#stat-sale-table tfoot input").blur( function (i) {
    if ( this.value == "" )
    {
      this.className = "search_init";
      this.value = asInitSaleMenuItemVals[$("#stat-sale-table tfoot th").index($(this).parent())];
    }
  } );
$('#food-stat h2').html("<%=  @sales['sales'].values.sum.select{|m| m['menu_item_details']['category_id'] == 1}.inject(0) {|sum,m| sum += (m['quantity'].to_f*m['menu_item_details']['unit_price'].to_f rescue 0) } %><small> VND (Foods)</small>");
$('#drink-drink-stat h2').html("<%=  @sales['sales'].values.sum.select{|m| m['menu_item_details']['category_id'] == 2 && m['menu_item_details']['mtype'] != 'Giải Khát'}.inject(0) {|sum,m| sum += (m['quantity'].to_f*m['menu_item_details']['unit_price'].to_f rescue 0) } %><small> VND (Drinks - Pha Chế)</small>");
$('#drink-service-stat h2').html("<%=  @sales['sales'].values.sum.select{|m| m['menu_item_details']['category_id'] == 2 && m['menu_item_details']['mtype'] == 'Giải Khát'}.inject(0) {|sum,m| sum += (m['quantity'].to_f*m['menu_item_details']['unit_price'].to_f rescue 0) } %><small> VND (Drinks - Đóng Chai)</small>");
$('#service-stat h2').html("<%=  @sales['sales'].values.sum.select{|m| m['menu_item_details']['category_id'] == 3 && m['menu_item_details'] == ''}.inject(0) {|sum,m| sum += (m['quantity'].to_f*m['menu_item_details']['unit_price'].to_f rescue 0) } %><small> VND (Services)</small>");
$('#naptk-stat h2').html("<%=  @sales['sales'].values.sum.select{|m| m['menu_item_details']['category_id'] == 4}.inject(0) {|sum,m| sum += (m['quantity'].to_f*m['menu_item_details']['unit_price'].to_f rescue 0) } %><small> VND (NAPTK)</small>");
<% end %>
